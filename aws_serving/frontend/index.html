<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Sentiment Analysis</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600&family=Syne:wght@400;600;700;800&display=swap" rel="stylesheet" />
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg:      #060910;
  --card:    #111827;
  --border:  #1f2d3d;
  --accent:  #00e5ff;
  --green:   #10b981;
  --red:     #ef4444;
  --yellow:  #f59e0b;
  --text:    #e2e8f0;
  --muted:   #64748b;
}

body {
  font-family: 'Syne', sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

body::before {
  content: '';
  position: fixed; inset: 0;
  background: radial-gradient(ellipse 80% 50% at 50% -10%, rgba(0,229,255,0.07) 0%, transparent 70%);
  pointer-events: none;
}

/* â”€â”€ NAV â”€â”€ */
nav {
  position: fixed; top: 0; left: 0; right: 0; z-index: 100;
  height: 56px;
  background: rgba(6,9,16,0.88);
  backdrop-filter: blur(16px);
  border-bottom: 1px solid var(--border);
  display: flex; align-items: center; justify-content: space-between;
  padding: 0 28px;
}
.nav-logo {
  font-size: 0.95rem; font-weight: 800; color: var(--accent);
  display: flex; align-items: center; gap: 8px; text-decoration: none;
}
.nav-dot {
  width: 8px; height: 8px; border-radius: 50%;
  background: var(--accent); box-shadow: 0 0 10px var(--accent);
  animation: blink 2s ease-in-out infinite;
}
@keyframes blink { 0%,100%{opacity:1} 50%{opacity:.4} }

.nav-link {
  font-size: 0.8rem; font-weight: 600; color: var(--muted);
  text-decoration: none; padding: 6px 14px; border-radius: 8px;
  border: 1px solid var(--border); transition: all 0.2s;
  font-family: 'JetBrains Mono', monospace;
}
.nav-link:hover { color: var(--accent); border-color: var(--accent); }

/* â”€â”€ MAIN â”€â”€ */
main {
  flex: 1; display: flex; align-items: center; justify-content: center;
  padding: 88px 24px 40px; position: relative; z-index: 1;
}

.card {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 20px;
  padding: 40px;
  width: 100%; max-width: 580px;
  box-shadow: 0 32px 64px rgba(0,0,0,0.5);
}

h1 {
  font-size: 1.7rem; font-weight: 800; text-align: center;
  margin-bottom: 4px; letter-spacing: -0.03em;
}
h1 span { color: var(--accent); }

.subtitle {
  text-align: center; color: var(--muted); font-size: 0.82rem;
  margin-bottom: 28px; font-family: 'JetBrains Mono', monospace;
}

/* â”€â”€ TEXTAREA â”€â”€ */
.input-wrap { position: relative; }
textarea {
  width: 100%; min-height: 130px;
  padding: 14px 16px;
  background: #0d1117;
  border: 1.5px solid var(--border);
  border-radius: 12px;
  color: var(--text);
  font-size: 0.95rem; font-family: 'Syne', sans-serif;
  resize: vertical; outline: none;
  transition: border-color 0.25s;
  line-height: 1.6;
}
textarea:focus { border-color: var(--accent); }
textarea::placeholder { color: var(--muted); }

.char-count {
  text-align: right; font-family: 'JetBrains Mono', monospace;
  font-size: 0.68rem; color: var(--muted); margin-top: 4px;
}

/* â”€â”€ BUTTON â”€â”€ */
button.btn-primary {
  display: block; width: 100%; margin-top: 16px;
  padding: 14px;
  background: var(--accent);
  color: #060910;
  font-size: 0.95rem; font-weight: 800;
  font-family: 'Syne', sans-serif;
  border: none; border-radius: 12px; cursor: pointer;
  transition: opacity 0.2s, transform 0.15s;
  letter-spacing: 0.02em;
}
button.btn-primary:hover { opacity: 0.88; transform: translateY(-1px); }
button.btn-primary:active { transform: translateY(0); }
button.btn-primary:disabled { background: #1f2d3d; color: var(--muted); cursor: not-allowed; transform: none; }

/* â”€â”€ RESULT â”€â”€ */
.result {
  margin-top: 24px;
  padding: 24px;
  background: #0d1117;
  border-radius: 14px;
  border: 1px solid var(--border);
  display: none; text-align: center;
  animation: fadeUp 0.35s ease;
}
.result.show { display: block; }
@keyframes fadeUp { from{opacity:0;transform:translateY(8px)} to{opacity:1;transform:translateY(0)} }

.result-emoji { font-size: 2.4rem; margin-bottom: 8px; }
.result-label {
  font-size: 1.6rem; font-weight: 800; letter-spacing: -0.02em;
  margin-bottom: 6px;
}
.result-label.pos { color: var(--green); }
.result-label.neg { color: var(--red); }
.result-label.neu { color: var(--yellow); }

.result-score {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.82rem; color: var(--muted); margin-bottom: 4px;
}
.confidence-bar-wrap {
  height: 4px; background: var(--border); border-radius: 999px;
  margin: 10px 0 8px; overflow: hidden;
}
.confidence-bar {
  height: 100%; border-radius: 999px;
  background: var(--green); width: 0%;
  transition: width 0.6s ease;
}
.confidence-bar.neg { background: var(--red); }
.confidence-bar.neu { background: var(--yellow); }

.result-model {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.68rem; color: #334155; margin-top: 4px;
}

/* â”€â”€ ERROR â”€â”€ */
.error {
  margin-top: 16px; padding: 12px 16px;
  background: rgba(239,68,68,0.1);
  border: 1px solid rgba(239,68,68,0.3);
  border-radius: 10px; color: #fca5a5;
  font-size: 0.83rem; text-align: center;
  display: none;
}
.error.show { display: block; }

/* â”€â”€ HISTORY â”€â”€ */
.history { margin-top: 24px; display: none; }
.history-title {
  font-size: 0.7rem; font-weight: 700; letter-spacing: 0.15em;
  color: var(--muted); text-transform: uppercase; margin-bottom: 10px;
  font-family: 'JetBrains Mono', monospace;
}
.history-item {
  display: flex; justify-content: space-between; align-items: center;
  padding: 8px 12px;
  background: #0d1117; border-radius: 8px; margin-bottom: 6px;
  font-size: 0.82rem; border: 1px solid #161f2e;
  gap: 12px;
}
.history-text {
  overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
  color: var(--muted); flex: 1;
}
.history-badge {
  font-size: 0.72rem; font-weight: 700; padding: 2px 8px;
  border-radius: 999px; flex-shrink: 0;
  font-family: 'JetBrains Mono', monospace;
}
.history-badge.pos { background: rgba(16,185,129,0.15); color: var(--green); }
.history-badge.neg { background: rgba(239,68,68,0.15); color: var(--red); }
.history-badge.neu { background: rgba(245,158,11,0.15); color: var(--yellow); }

/* â”€â”€ FOOTER â”€â”€ */
footer {
  text-align: center; padding: 20px;
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.68rem; color: #1f2d3d;
  position: relative; z-index: 1;
}
</style>
</head>
<body>

<nav>
  <a class="nav-logo" href="/">
    <div class="nav-dot"></div>
    SentimentML
  </a>
  <!-- Link to the dashboard â€” opened via nginx proxy or direct port -->
  <a class="nav-link" href="/dashboard" target="_blank">ðŸ“Š Dashboard</a>
</nav>

<main>
  <div class="card">
    <h1>ðŸŽ­ <span>Sentiment</span> Analysis</h1>
    <p class="subtitle">Powered by MLflow Â· Deployed on AWS</p>

    <div class="input-wrap">
      <textarea
        id="textInput"
        placeholder="Type or paste text hereâ€¦ (Press Shift+Enter for new line, Enter to analyze)"
        maxlength="2000"
        oninput="updateCharCount()"
      ></textarea>
      <div class="char-count"><span id="charCount">0</span> / 2000</div>
    </div>

    <button class="btn-primary" id="analyzeBtn" onclick="analyze()">
      Analyze Sentiment
    </button>

    <div class="error" id="errorBox"></div>

    <div class="result" id="resultBox">
      <div class="result-emoji" id="resultEmoji"></div>
      <div class="result-label" id="resultLabel"></div>
      <div class="result-score" id="resultScore"></div>
      <div class="confidence-bar-wrap">
        <div class="confidence-bar" id="confBar"></div>
      </div>
      <div class="result-model" id="resultModel"></div>
    </div>

    <div class="history" id="historyBox">
      <div class="history-title">Recent Predictions</div>
      <div id="historyList"></div>
    </div>
  </div>
</main>

<footer>Sentiment MLOps Â· AWS Â· MLflow</footer>

<script>
// Nginx proxies /api/* â†’ Flask backend on port 5000
const API_URL = "/api/predict";
const history = [];

function updateCharCount() {
  const len = document.getElementById("textInput").value.length;
  document.getElementById("charCount").textContent = len;
}

function getSentimentClass(label) {
  const l = label.toLowerCase();
  if (l.includes("pos") || l === "1") return "pos";
  if (l.includes("neg") || l === "0") return "neg";
  return "neu";
}

function getSentimentEmoji(cls) {
  return { pos: "ðŸ˜Š", neg: "ðŸ˜ž", neu: "ðŸ˜" }[cls] || "ðŸ¤”";
}

async function analyze() {
  const text = document.getElementById("textInput").value.trim();
  if (!text) return;

  const btn    = document.getElementById("analyzeBtn");
  const result = document.getElementById("resultBox");
  const errBox = document.getElementById("errorBox");

  btn.disabled = true;
  btn.textContent = "Analyzingâ€¦";
  result.classList.remove("show");
  errBox.classList.remove("show");

  try {
    const resp = await fetch(API_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ text }),
    });
    if (!resp.ok) throw new Error(`Server error: ${resp.status}`);
    const data = await resp.json();
    if (data.error) throw new Error(data.error);

    const pred = data.predictions;
    let label, score;

    if (Array.isArray(pred) && pred.length > 0) {
      if (typeof pred[0] === "object") {
        label = pred[0].label || Object.values(pred[0])[0];
        score = pred[0].score ?? null;
      } else {
        label = String(pred[0]);
        score = null;
      }
    } else {
      label = String(pred);
      score = null;
    }

    const cls   = getSentimentClass(label);
    const emoji = getSentimentEmoji(cls);

    document.getElementById("resultEmoji").textContent = emoji;

    const labelEl = document.getElementById("resultLabel");
    labelEl.textContent = label.toUpperCase();
    labelEl.className = `result-label ${cls}`;

    document.getElementById("resultScore").textContent =
      score !== null ? `Confidence: ${(score * 100).toFixed(1)}%` : "";

    const bar = document.getElementById("confBar");
    bar.className = `confidence-bar ${cls}`;
    setTimeout(() => { bar.style.width = score !== null ? `${(score * 100).toFixed(1)}%` : "100%"; }, 50);

    document.getElementById("resultModel").textContent =
      `model: ${data.model_type || "unknown"} Â· ${data.response_time_ms || 0}ms`;

    result.classList.add("show");

    // History
    history.unshift({ text: text.substring(0, 55), label, cls });
    if (history.length > 5) history.pop();
    renderHistory();

  } catch (err) {
    errBox.textContent = `âŒ ${err.message}`;
    errBox.classList.add("show");
  } finally {
    btn.disabled = false;
    btn.textContent = "Analyze Sentiment";
  }
}

function renderHistory() {
  if (!history.length) return;
  document.getElementById("historyBox").style.display = "block";
  document.getElementById("historyList").innerHTML = history.map(h => `
    <div class="history-item">
      <span class="history-text">${h.text}${h.text.length >= 55 ? "â€¦" : ""}</span>
      <span class="history-badge ${h.cls}">${h.label}</span>
    </div>`).join("");
}

// Enter = analyze, Shift+Enter = newline
document.getElementById("textInput").addEventListener("keydown", e => {
  if (e.key === "Enter" && !e.shiftKey) { e.preventDefault(); analyze(); }
});
</script>
</body>
</html>